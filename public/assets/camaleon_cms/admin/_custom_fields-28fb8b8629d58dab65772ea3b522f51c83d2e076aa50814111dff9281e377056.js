function build_custom_field_group(e,t,i,a,n){function l(e){var t=d.clone();for(var a in t.find("input, textarea, select").not(".code_style").each(function(){$(this).attr("name",$(this).attr("name").replace(n,n+"["+s+"]"))}),r.append(t),o.trigger("update_custom_group_number"),i)cama_build_custom_field(t.find(".content-field-"+i[a].id),i[a],e[a]);return 0==s&&t.children(".header-field-grouped").find(".del").remove(),s++,!1}0==e.length&&(e=[{}]);var o=$("#custom_field_group_"+t),r=o.find(" > .panel-body"),d=r.children(".custom_sortable_grouped").clone().removeClass("hidden"),s=0;r.children(".custom_sortable_grouped").remove(),a?(r.sortable({handle:".move.fa-arrows",items:" > .custom_sortable_grouped",update:function(){o.trigger("update_custom_group_number")},start:function(e,t){$(t.item).find(".mce-panel").each(function(){tinymce.execCommand("mceRemoveEditor",!1,$(this).next().addClass("cama_restore_editor").attr("id"))})},stop:function(e,t){$(t.item).find(".cama_restore_editor").each(function(){tinymce.execCommand("mceAddEditor",!0,$(this).attr("id"))})}}),o.find(".btn.duplicate_cutom_group").click(l),r.on("click",".header-field-grouped .del",function(){return confirm(I18n("msg.delete_item"))&&$(this).closest(".custom_sortable_grouped").fadeOut("slow",function(){$(this).remove(),o.trigger("update_custom_group_number")}),!1}),r.on("click",".header-field-grouped .toggleable",function(){return $(this).hasClass("fa-angle-down")?$(this).removeClass("fa-angle-down").addClass("fa-angle-up").closest(".header-field-grouped").next().slideUp():$(this).removeClass("fa-angle-up").addClass("fa-angle-down").closest(".header-field-grouped").next().slideDown(),!1}),o.bind("update_custom_group_number",function(){$(this).find(".custom_sortable_grouped").each(function(e){$(this).find("input.cama_custom_group_number").val(e)})}),$.each(e,function(){l(this)})):l(e[0])}function cama_build_custom_field(e,a,t){function i(e){var t=l.clone(!0);a.multiple&&(t.prepend(o),0==n&&t.children(".actions").find(".fa-times").remove()),l.find(".group-input-fields-content").hasClass("cama_skip_cf_rename_multiple")||t.find("input, textarea, select").each(function(){$(this).attr("name",$(this).attr("name").replace("[]","["+n+"]"))}),a.disabled&&(t.find("input, textarea, select").prop("readonly",!0).filter("select").click(function(){return!1}).focus(function(){$(this).blur()}),t.find(".btn").addClass("disabled").unbind().click(function(){return!1})),"checkbox"==a.kind?t.find("input")[0].checked=e:e&&t.find(".input-value").val(e).trigger("change",{field_rendered:!0}).data("value",e),d.append(t),r&&window[r](t,e),n++}t=t||[];var n=0,l=e.clone().wrap("li");e.html("<div class='cama_w_custom_fields'></div>"+(a.multiple?"<div class='field_multiple_btn'> <a href='#' class='btn btn-warning btn-xs'> <i class='fa fa-plus'></i> "+e.attr("data-add_field_title")+"</a></div>":""));var o='<div class="actions"><i style="cursor: move" class="fa fa-arrows"></i> <i style="cursor: pointer" class="fa fa-times text-danger"></i></div>',r=l.find(".group-input-fields-content").attr("data-callback-render"),d=e.children(".cama_w_custom_fields");"checkbox"!=a.kind&&t.length<=0&&(t=[a.default_value]),"checkboxes"!=a.kind?(!a.multiple&&1<t.length&&(t=[t[0]]),"checkbox"==a.kind?i(t[0]):$.each(t,function(e,t){i(t)})):i(t),a.multiple&&(e.find(".field_multiple_btn .btn").click(function(){return i(a.default_value),!1}),e.delegate(".actions .fa-times","click",function(){return confirm(I18n("msg.delete_item"))&&$(this).closest(".editor-custom-fields").remove(),!1}),d.sortable({handle:".fa-arrows",items:" > .editor-custom-fields",start:function(e,t){$(t.item).find(".mce-panel").each(function(){tinymce.execCommand("mceRemoveEditor",!1,$(this).next().addClass("cama_restore_editor").attr("id"))})},stop:function(e,t){$(t.item).find(".cama_restore_editor").each(function(){tinymce.execCommand("mceAddEditor",!0,$(this).attr("id"))})}}))}function custom_field_colorpicker(e){e&&e.find(".my-colorpicker").colorpicker()}function custom_field_colorpicker_val(e,t){e&&e.find(".my-colorpicker").attr("data-color",t||"").colorpicker()}function custom_field_checkbox_val(e,t){"t"==t&&(t=1),e&&e.find('input[value="'+t+'"]').prop("checked",!0)}function custom_field_checkboxs_val(e,t){if(e){var a=t.map(function(e){return"input[value='"+e+"']"}).join(",");e.find(a).prop("checked",!0)}}function custom_field_date(e){if(e){var t=e.find(".date-input-box");t.hasClass("is_datetimepicker")?t.datetimepicker({format:"YYYY-MM-DD HH:mm"}):t.datepicker()}}function custom_field_editor(e){if(e){var t="t_"+Math.floor(1e5*Math.random()+1)+"_area",a=e.find("textarea").attr("id",t);if(a.hasClass("is_translate")){a.addClass("translatable").Translatable(ADMIN_TRANSLATIONS);var i=a.data("translation_inputs");if(i){for(var n in i)tinymce.init(cama_get_tinymce_settings({selector:"#"+i[n].attr("id"),height:120}));return}}tinymce.init(cama_get_tinymce_settings({selector:"#"+t,height:120}))}}function custom_field_field_attrs_val(e,t){if(e){var a="object"==typeof(t=t||"{}")?t:$.parseJSON(t);e.find(".input-attr").val(a.attr),e.find(".input-value").val(a.value),e.find(".input-attr, .input-value").filter(".is_translate").addClass("translatable").Translatable(ADMIN_TRANSLATIONS)}}function custom_field_radio_val(e,t){e&&(e.find("input").prop("checked",!1),e.find("input[value='"+t+"']").prop("checked",!0))}function custom_field_text_area(e){e&&e.find("textarea").hasClass("is_translate")&&e.find("textarea").addClass("translatable").Translatable(ADMIN_TRANSLATIONS)}function custom_field_text_box(e){e&&e.find("input").hasClass("is_translate")&&e.find("input").addClass("translatable").Translatable(ADMIN_TRANSLATIONS)}function custom_field_url_callback(e){e&&e.find("input").hasClass("is_translate")&&e.find("input").addClass("translatable").Translatable(ADMIN_TRANSLATIONS)}function custom_field_select_callback(e,t){if(e){var a=e.find("select.input-value");t||a.data("value",a.val()),a.hasClass("is_translate")&&a.addClass("translatable").Translatable(ADMIN_TRANSLATIONS)}}function load_upload_audio_field(e){var t=$(e).prev();$.fn.upload_filemanager({formats:"audio",selected:function(e){t.val(e.url)}})}function load_upload_file_field(e){var t=$(e).prev();$.fn.upload_filemanager({formats:t.data("formats")?t.data("formats"):"",selected:function(e){t.val(e.url)}})}function load_upload_private_file_field(e){var t=$(e).prev();$.fn.upload_filemanager({formats:t.data("formats")?t.data("formats"):"",selected:function(e){t.val(e.url.split("?file=")[1].replace(/%2/g,"/"))},"private":!0})}function load_upload_image_field(t){$.fn.upload_filemanager({formats:"image",dimension:t.attr("data-dimension")||"",versions:t.attr("data-versions")||"",thumb_size:t.attr("data-thumb_size")||"",selected:function(e){t.val(e.url).trigger("change")}})}function cama_custom_field_image_changed(e){e.val()?e.closest(".input-group").append('<span class="input-group-addon custom_field_image_preview"><a href="'+e.val()+'" target="_blank"><img src="'+e.val()+'" style="width: 50px; height: 20px;"></a></span>'):e.closest(".input-group").find(".custom_field_image_preview").remove()}function load_upload_video_field(e){var t=$(e).prev();$.fn.upload_filemanager({formats:"video",selected:function(e){t.val(e.url)}})}