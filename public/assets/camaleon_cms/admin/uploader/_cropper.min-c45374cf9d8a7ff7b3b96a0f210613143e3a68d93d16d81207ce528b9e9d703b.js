!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}(function(x){"use strict";function C(t){return"number"==typeof t&&!isNaN(t)}function n(t){return void 0===t}function s(t,i){var e=[];return C(i)&&e.push(i),e.slice.apply(t,e)}function a(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function h(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==B.protocol||i[2]!==B.hostname||i[3]!==B.port)}function r(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function p(t){return t?' crossOrigin="'+t+'"':""}function e(t,i){var e;if(t.naturalWidth&&!mt)return i(t.naturalWidth,t.naturalHeight);(e=document.createElement("img")).onload=function(){i(this.width,this.height)},e.src=t.src}function u(t){var i=[],e=t.rotate,s=t.scaleX,a=t.scaleY;return C(e)&&0!==e&&i.push("rotate("+e+"deg)"),C(s)&&1!==s&&i.push("scaleX("+s+")"),C(a)&&1!==a&&i.push("scaleY("+a+")"),i.length?i.join(" "):"none"}function b(t,i){var e,s,a=Ct(t.degree)%180,o=(90<a?180-a:a)*Math.PI/180,h=bt(o),n=Bt(o),r=t.width,p=t.height,l=t.aspectRatio;return i?s=(e=r/(n+h/l))/l:(e=r*n+p*h,s=r*h+p*n),{width:e,height:s}}function v(t,i){var e,s,a,o=x("<canvas>")[0],h=o.getContext("2d"),n=0,r=0,p=i.naturalWidth,l=i.naturalHeight,c=i.rotate,d=i.scaleX,g=i.scaleY,u=C(d)&&C(g)&&(1!==d||1!==g),f=C(c)&&0!==c,m=f||u,v=p*Ct(d||1),w=l*Ct(g||1);return u&&(e=v/2,s=w/2),f&&(e=(v=(a=b({width:v,height:w,degree:c})).width)/2,s=(w=a.height)/2),o.width=v,o.height=w,m&&(n=-p/2,r=-l/2,h.save(),h.translate(e,s)),f&&h.rotate(c*Math.PI/180),u&&h.scale(d,g),h.drawImage(t,$t(n),$t(r),$t(p),$t(l)),m&&h.restore(),o}function g(t){var i=t.length,e=0,s=0;return i&&(x.each(t,function(t,i){e+=i.pageX,s+=i.pageY}),e/=i,s/=i),{pageX:e,pageY:s}}function d(t,i,e){var s,a="";for(e+=s=i;s<e;s++)a+=Lt(t.getUint8(s));return a}function l(t){var i,e,s,a,o,h,n,r,p,l=new $(t),c=l.byteLength;if(255===l.getUint8(0)&&216===l.getUint8(1))for(r=2;r<c;){if(255===l.getUint8(r)&&225===l.getUint8(r+1)){h=r;break}r++}if(h&&(e=h+10,"Exif"===d(l,h+4,4)&&((a=18761===(o=l.getUint16(e)))||19789===o)&&42===l.getUint16(e+2,a)&&8<=(s=l.getUint32(e+4,a))&&(n=e+s)),n)for(c=l.getUint16(n,a),p=0;p<c;p++)if(r=n+12*p+2,274===l.getUint16(r,a)){r+=8,i=l.getUint16(r,a),mt&&l.setUint16(r,1,a);break}return i}function o(t){var i,e=t.replace(G,""),s=atob(e),a=s.length,o=new y(a),h=new D(o);for(i=0;i<a;i++)h[i]=s.charCodeAt(i);return o}function c(t){var i,e=new D(t),s=e.length,a="";for(i=0;i<s;i++)a+=Lt(e[i]);return"data:image/jpeg;base64,"+L(a)}function f(t,i){this.$element=x(t),this.options=x.extend({},f.DEFAULTS,x.isPlainObject(i)&&i),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var m=x(window),w=x(document),B=window.location,t=window.navigator,y=window.ArrayBuffer,D=window.Uint8Array,$=window.DataView,L=window.btoa,T="cropper",X="cropper-modal",Y="cropper-hide",k="cropper-hidden",M="cropper-invisible",W="cropper-move",H="cropper-crop",i="cropper-disabled",R="cropper-bg",z="mousedown touchstart pointerdown MSPointerDown",O="mousemove touchmove pointermove MSPointerMove",P="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",E="wheel mousewheel DOMMouseScroll",I="dblclick",U="load."+T,F="error."+T,j="resize."+T,A="build."+T,S="built."+T,N="cropstart."+T,_="cropmove."+T,q="cropend."+T,K="crop."+T,Z="zoom."+T,Q=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,V=/^data:/,G=/^data:([^;]+);base64,/,J=/^data:image\/jpeg.*;base64,/,tt="preview",it="action",et="e",st="w",at="s",ot="n",ht="se",nt="sw",rt="ne",pt="nw",lt="all",ct="crop",dt="move",gt="zoom",ut="none",ft=x.isFunction(x("<canvas>")[0].getContext),mt=t&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(t.userAgent),vt=Number,wt=Math.min,xt=Math.max,Ct=Math.abs,bt=Math.sin,Bt=Math.cos,yt=Math.sqrt,Dt=Math.round,$t=Math.floor,Lt=String.fromCharCode;f.prototype={constructor:f,init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&ft&&(t=i[0].toDataURL());this.load(t)},trigger:function(t,i){var e=x.Event(t,i);return this.$element.trigger(e),e},load:function(t){var i,e,s=this.options,a=this.$element;if(t&&(a.one(A,s.build),!this.trigger(A).isDefaultPrevented())){if(this.url=t,this.image={},!s.checkOrientation||!y)return this.clone();if(i=x.proxy(this.read,this),V.test(t))return J.test(t)?i(o(t)):this.clone();(e=new XMLHttpRequest).onerror=e.onabort=x.proxy(function(){this.clone()},this),e.onload=function(){i(this.response)},s.checkCrossOrigin&&h(t)&&a.prop("crossOrigin")&&(t=r(t)),e.open("get",t),e.responseType="arraybuffer",e.send()}},read:function(t){var i=this.options,e=l(t),s=this.image,a=0,o=1,h=1;if(1<e)switch(this.url=c(t),e){case 2:o=-1;break;case 3:a=-180;break;case 4:h=-1;break;case 5:a=90,h=-1;break;case 6:a=90;break;case 7:a=90,o=-1;break;case 8:a=-90}i.rotatable&&(s.rotate=a),i.scalable&&(s.scaleX=o,s.scaleY=h),this.clone()},clone:function(){var t,i,e=this.options,s=this.$element,a=this.url,o="";e.checkCrossOrigin&&h(a)&&((o=s.prop("crossOrigin"))?t=a:(o="anonymous",t=r(a))),this.crossOrigin=o,this.crossOriginUrl=t,this.$clone=i=x("<img"+p(o)+' src="'+(t||a)+'">'),this.isImg?s[0].complete?this.start():s.one(U,x.proxy(this.start,this)):i.one(U,x.proxy(this.start,this)).one(F,x.proxy(this.stop,this)).addClass(Y).insertAfter(s)},start:function(){var t=this.$element,i=this.$clone;this.isImg||(i.off(F,this.stop),t=i),e(t[0],x.proxy(function(t,i){x.extend(this.image,{naturalWidth:t,naturalHeight:i,aspectRatio:t/i}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var t,i,e,s=this.options,a=this.$element,o=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=a.parent(),this.$cropper=t=x(f.TEMPLATE),this.$canvas=t.find(".cropper-canvas").append(o),this.$dragBox=t.find(".cropper-drag-box"),this.$cropBox=i=t.find(".cropper-crop-box"),this.$viewBox=t.find(".cropper-view-box"),this.$face=e=i.find(".cropper-face"),a.addClass(k).after(t),this.isImg||o.removeClass(Y),this.initPreview(),this.bind(),s.aspectRatio=xt(0,s.aspectRatio)||NaN,s.viewMode=xt(0,wt(3,Dt(s.viewMode)))||0,s.autoCrop?(this.isCropped=!0,s.modal&&this.$dragBox.addClass(X)):i.addClass(k),s.guides||i.find(".cropper-dashed").addClass(k),s.center||i.find(".cropper-center").addClass(k),s.cropBoxMovable&&e.addClass(W).data(it,lt),s.highlight||e.addClass(M),s.background&&t.addClass(R),s.cropBoxResizable||i.find(".cropper-line, .cropper-point").addClass(k),this.setDragMode(s.dragMode),this.render(),this.isBuilt=!0,this.setData(s.data),a.one(S,s.built),this.completing=setTimeout(x.proxy(function(){this.trigger(S),this.trigger(K,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isCompleted||clearTimeout(this.completing),this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,s=this.$cropper;s.addClass(k),i.removeClass(k),s.css(this.container={width:xt(e.width(),vt(t.minContainerWidth)||200),height:xt(e.height(),vt(t.minContainerHeight)||100)}),i.addClass(k),s.removeClass(k)},initCanvas:function(){var t,i=this.options.viewMode,e=this.container,s=e.width,a=e.height,o=this.image,h=o.naturalWidth,n=o.naturalHeight,r=90===Ct(o.rotate),p=r?n:h,l=r?h:n,c=p/l,d=s,g=a;s<a*c?3===i?d=a*c:g=s/c:3===i?g=s/c:d=a*c,(t={naturalWidth:p,naturalHeight:l,aspectRatio:c,width:d,height:g}).oldLeft=t.left=(s-d)/2,t.oldTop=t.top=(a-g)/2,this.canvas=t,this.isLimited=1===i||2===i,this.limitCanvas(!0,!0),this.initialImage=x.extend({},o),this.initialCanvas=x.extend({},t)},limitCanvas:function(t,i){var e,s,a,o,h=this.options,n=h.viewMode,r=this.container,p=r.width,l=r.height,c=this.canvas,d=c.aspectRatio,g=this.cropBox,u=this.isCropped&&g;t&&(e=vt(h.minCanvasWidth)||0,s=vt(h.minCanvasHeight)||0,n&&(1<n?(e=xt(e,p),s=xt(s,l),3===n&&(e<s*d?e=s*d:s=e/d)):e?e=xt(e,u?g.width:0):s?s=xt(s,u?g.height:0):u&&((e=g.width)<(s=g.height)*d?e=s*d:s=e/d)),e&&s?e<s*d?s=e/d:e=s*d:e?s=e/d:s&&(e=s*d),c.minWidth=e,c.minHeight=s,c.maxWidth=Infinity,c.maxHeight=Infinity),i&&(n?(a=p-c.width,o=l-c.height,c.minLeft=wt(0,a),c.minTop=wt(0,o),c.maxLeft=xt(0,a),c.maxTop=xt(0,o),u&&this.isLimited&&(c.minLeft=wt(g.left,g.left+g.width-c.width),c.minTop=wt(g.top,g.top+g.height-c.height),c.maxLeft=g.left,c.maxTop=g.top,2===n&&(c.width>=p&&(c.minLeft=wt(0,a),c.maxLeft=xt(0,a)),c.height>=l&&(c.minTop=wt(0,o),c.maxTop=xt(0,o))))):(c.minLeft=-c.width,c.minTop=-c.height,c.maxLeft=p,c.maxTop=l))},renderCanvas:function(t){var i,e,s=this.canvas,a=this.image,o=a.rotate,h=a.naturalWidth,n=a.naturalHeight;this.isRotated&&(this.isRotated=!1,(i=(e=b({width:a.width,height:a.height,degree:o})).width/e.height)!==s.aspectRatio&&(s.left-=(e.width-s.width)/2,s.top-=(e.height-s.height)/2,s.width=e.width,s.height=e.height,s.aspectRatio=i,s.naturalWidth=h,s.naturalHeight=n,o%180&&(e=b({width:h,height:n,degree:o}),s.naturalWidth=e.width,s.naturalHeight=e.height),this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=wt(xt(s.width,s.minWidth),s.maxWidth),s.height=wt(xt(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=wt(xt(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=wt(xt(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(t){var i,e=this.canvas,s=this.image;s.rotate&&(i=b({width:e.width,height:e.height,degree:s.rotate,aspectRatio:s.aspectRatio},!0)),x.extend(s,i?{width:i.width,height:i.height,left:(e.width-i.width)/2,top:(e.height-i.height)/2}:{width:e.width,height:e.height,left:0,top:0}),this.$clone.css({width:s.width,height:s.height,marginLeft:s.left,marginTop:s.top,transform:u(s)}),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvas,e=t.aspectRatio,s=vt(t.autoCropArea)||.8,a={width:i.width,height:i.height};e&&(i.height*e>i.width?a.height=a.width/e:a.width=a.height*e),this.cropBox=a,this.limitCropBox(!0,!0),a.width=wt(xt(a.width,a.minWidth),a.maxWidth),a.height=wt(xt(a.height,a.minHeight),a.maxHeight),a.width=xt(a.minWidth,a.width*s),a.height=xt(a.minHeight,a.height*s),a.oldLeft=a.left=i.left+(i.width-a.width)/2,a.oldTop=a.top=i.top+(i.height-a.height)/2,this.initialCropBox=x.extend({},a)},limitCropBox:function(t,i){var e,s,a,o,h=this.options,n=h.aspectRatio,r=this.container,p=r.width,l=r.height,c=this.canvas,d=this.cropBox,g=this.isLimited;t&&(e=vt(h.minCropBoxWidth)||0,s=vt(h.minCropBoxHeight)||0,e=wt(e,p),s=wt(s,l),a=wt(p,g?c.width:p),o=wt(l,g?c.height:l),n&&(e&&s?e<s*n?s=e/n:e=s*n:e?s=e/n:s&&(e=s*n),a<o*n?o=a/n:a=o*n),d.minWidth=wt(e,a),d.minHeight=wt(s,o),d.maxWidth=a,d.maxHeight=o),i&&(g?(d.minLeft=xt(0,c.left),d.minTop=xt(0,c.top),d.maxLeft=wt(p,c.left+c.width)-d.width,d.maxTop=wt(l,c.top+c.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=p-d.width,d.maxTop=l-d.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,s=i.height,a=this.cropBox;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=wt(xt(a.width,a.minWidth),a.maxWidth),a.height=wt(xt(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.oldLeft=a.left=wt(xt(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=wt(xt(a.top,a.minTop),a.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data(it,a.width===e&&a.height===s?dt:lt),this.$cropBox.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(K,this.getData())},initPreview:function(){var t,i=p(this.crossOrigin),e=i?this.crossOriginUrl:this.url;this.$preview=x(this.options.preview),this.$clone2=t=x("<img"+i+' src="'+e+'">'),this.$viewBox.html(t),this.$preview.each(function(){var t=x(this);t.data(tt,{width:t.width(),height:t.height(),html:t.html()}),t.html("<img"+i+' src="'+e+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var t=x(this),i=t.data(tt);t.css({width:i.width,height:i.height}).html(i.html).removeData(tt)})},preview:function(){var n=this.image,t=this.canvas,i=this.cropBox,r=i.width,p=i.height,l=n.width,c=n.height,d=i.left-t.left-n.left,g=i.top-t.top-n.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:l,height:c,marginLeft:-d,marginTop:-g,transform:u(n)}),this.$preview.each(function(){var t=x(this),i=t.data(tt),e=i.width,s=i.height,a=e,o=s,h=1;r&&(o=p*(h=e/r)),p&&s<o&&(a=r*(h=s/p),o=s),t.css({width:a,height:o}).find("img").css({width:l*h,height:c*h,marginLeft:-d*h,marginTop:-g*h,transform:u(n)})}))},bind:function(){var t=this.options,i=this.$element,e=this.$cropper;x.isFunction(t.cropstart)&&i.on(N,t.cropstart),x.isFunction(t.cropmove)&&i.on(_,t.cropmove),x.isFunction(t.cropend)&&i.on(q,t.cropend),x.isFunction(t.crop)&&i.on(K,t.crop),x.isFunction(t.zoom)&&i.on(Z,t.zoom),e.on(z,x.proxy(this.cropStart,this)),t.zoomable&&t.zoomOnWheel&&e.on(E,x.proxy(this.wheel,this)),t.toggleDragModeOnDblclick&&e.on(I,x.proxy(this.dblclick,this)),w.on(O,this._cropMove=a(this.cropMove,this)).on(P,this._cropEnd=a(this.cropEnd,this)),t.responsive&&m.on(j,this._resize=a(this.resize,this))},unbind:function(){var t=this.options,i=this.$element,e=this.$cropper;x.isFunction(t.cropstart)&&i.off(N,t.cropstart),x.isFunction(t.cropmove)&&i.off(_,t.cropmove),x.isFunction(t.cropend)&&i.off(q,t.cropend),x.isFunction(t.crop)&&i.off(K,t.crop),x.isFunction(t.zoom)&&i.off(Z,t.zoom),e.off(z,this.cropStart),t.zoomable&&t.zoomOnWheel&&e.off(E,this.wheel),t.toggleDragModeOnDblclick&&e.off(I,this.dblclick),w.off(O,this._cropMove).off(P,this._cropEnd),t.responsive&&m.off(j,this._resize)},resize:function(){var e,s,a,t=this.options.restore,i=this.$container,o=this.container;!this.isDisabled&&o&&(1===(a=i.width()/o.width)&&i.height()===o.height||(t&&(e=this.getCanvasData(),s=this.getCropBoxData()),this.render(),t&&(this.setCanvasData(x.each(e,function(t,i){e[t]=i*a})),this.setCropBoxData(x.each(s,function(t,i){s[t]=i*a})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(H)?this.setDragMode(dt):this.setDragMode(ct))},wheel:function(t){var i=t.originalEvent||t,e=vt(this.options.wheelZoomRatio)||.1,s=1;this.isDisabled||(t.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(x.proxy(function(){this.wheeling=!1},this),50),i.deltaY?s=0<i.deltaY?1:-1:i.wheelDelta?s=-i.wheelDelta/120:i.detail&&(s=0<i.detail?1:-1),this.zoom(-s*e,t)))},cropStart:function(t){var i,e,s=this.options,a=t.originalEvent,o=a&&a.touches,h=t;if(!this.isDisabled){if(o){if(1<(i=o.length)){if(!s.zoomable||!s.zoomOnTouch||2!==i)return;h=o[1],this.startX2=h.pageX,this.startY2=h.pageY,e=gt}h=o[0]}if(e=e||x(h.target).data(it),Q.test(e)){if(this.trigger(N,{originalEvent:a,action:e}).isDefaultPrevented())return;t.preventDefault(),this.action=e,this.cropping=!1,this.startX=h.pageX||a&&a.pageX,this.startY=h.pageY||a&&a.pageY,e===ct&&(this.cropping=!0,this.$dragBox.addClass(X))}}},cropMove:function(t){var i,e=this.options,s=t.originalEvent,a=s&&s.touches,o=t,h=this.action;if(!this.isDisabled){if(a){if(1<(i=a.length)){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;o=a[1],this.endX2=o.pageX,this.endY2=o.pageY}o=a[0]}if(h){if(this.trigger(_,{originalEvent:s,action:h}).isDefaultPrevented())return;t.preventDefault(),this.endX=o.pageX||s&&s.pageX,this.endY=o.pageY||s&&s.pageY,this.change(o.shiftKey,h===gt?t:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(X,this.isCropped&&this.options.modal)),this.action="",this.trigger(q,{originalEvent:i,action:e}))},change:function(t,i){var e,s,a,o,h,n,r,p=this.options.aspectRatio,l=this.action,c=this.container,d=this.canvas,g=this.cropBox,u=g.width,f=g.height,m=g.left,v=g.top,w=m+u,x=v+f,C=0,b=0,B=c.width,y=c.height,D=!0;switch(!p&&t&&(p=u&&f?u/f:1),this.isLimited&&(C=g.minLeft,b=g.minTop,B=C+wt(c.width,d.width,d.left+d.width),y=b+wt(c.height,d.height,d.top+d.height)),s={x:this.endX-this.startX,y:this.endY-this.startY},p&&(s.X=s.y*p,s.Y=s.x/p),l){case lt:m+=s.x,v+=s.y;break;case et:if(0<=s.x&&(B<=w||p&&(v<=b||y<=x))){D=!1;break}u+=s.x,p&&(f=u/p,v-=s.Y/2),u<0&&(l=st,u=0);break;case ot:if(s.y<=0&&(v<=b||p&&(m<=C||B<=w))){D=!1;break}f-=s.y,v+=s.y,p&&(u=f*p,m+=s.X/2),f<0&&(l=at,f=0);break;case st:if(s.x<=0&&(m<=C||p&&(v<=b||y<=x))){D=!1;break}u-=s.x,m+=s.x,p&&(f=u/p,v+=s.Y/2),u<0&&(l=et,u=0);break;case at:if(0<=s.y&&(y<=x||p&&(m<=C||B<=w))){D=!1;break}f+=s.y,p&&(u=f*p,m-=s.X/2),f<0&&(l=ot,f=0);break;case rt:if(p){if(s.y<=0&&(v<=b||B<=w)){D=!1;break}f-=s.y,v+=s.y,u=f*p}else 0<=s.x?w<B?u+=s.x:s.y<=0&&v<=b&&(D=!1):u+=s.x,s.y<=0?b<v&&(f-=s.y,v+=s.y):(f-=s.y,v+=s.y);u<0&&f<0?(l=nt,u=f=0):u<0?(l=pt,u=0):f<0&&(l=ht,f=0);break;case pt:if(p){if(s.y<=0&&(v<=b||m<=C)){D=!1;break}f-=s.y,v+=s.y,u=f*p,m+=s.X}else s.x<=0?C<m?(u-=s.x,m+=s.x):s.y<=0&&v<=b&&(D=!1):(u-=s.x,m+=s.x),s.y<=0?b<v&&(f-=s.y,v+=s.y):(f-=s.y,v+=s.y);u<0&&f<0?(l=ht,u=f=0):u<0?(l=rt,u=0):f<0&&(l=nt,f=0);break;case nt:if(p){if(s.x<=0&&(m<=C||y<=x)){D=!1;break}u-=s.x,m+=s.x,f=u/p}else s.x<=0?C<m?(u-=s.x,m+=s.x):0<=s.y&&y<=x&&(D=!1):(u-=s.x,m+=s.x),0<=s.y?x<y&&(f+=s.y):f+=s.y;u<0&&f<0?(l=rt,u=f=0):u<0?(l=ht,u=0):f<0&&(l=pt,f=0);break;case ht:if(p){if(0<=s.x&&(B<=w||y<=x)){D=!1;break}f=(u+=s.x)/p}else 0<=s.x?w<B?u+=s.x:0<=s.y&&y<=x&&(D=!1):u+=s.x,0<=s.y?x<y&&(f+=s.y):f+=s.y;u<0&&f<0?(l=pt,u=f=0):u<0?(l=nt,u=0):f<0&&(l=rt,f=0);break;case dt:this.move(s.x,s.y),D=!1;break;case gt:this.zoom((a=Ct(this.startX-this.startX2),o=Ct(this.startY-this.startY2),h=Ct(this.endX-this.endX2),n=Ct(this.endY-this.endY2),r=yt(a*a+o*o),(yt(h*h+n*n)-r)/r),i),this.startX2=this.endX2,this.startY2=this.endY2,D=!1;break;case ct:if(!s.x||!s.y){D=!1;break}e=this.$cropper.offset(),m=this.startX-e.left,v=this.startY-e.top,u=g.minWidth,f=g.minHeight,0<s.x?l=0<s.y?ht:rt:s.x<0&&(m-=u,l=0<s.y?nt:pt),s.y<0&&(v-=f),this.isCropped||(this.$cropBox.removeClass(k),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}D&&(g.width=u,g.height=f,g.left=m,g.top=v,this.action=l,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(X),this.$cropBox.removeClass(k)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=x.extend({},this.initialImage),this.canvas=x.extend({},this.initialCanvas),this.cropBox=x.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(x.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(X),this.$cropBox.addClass(k))},replace:function(t,i){!this.isDisabled&&t&&(this.isImg&&this.$element.attr("src",t),i?(this.url=t,this.$clone.attr("src",t),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",t)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(t)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(i))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(i))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(k)):this.isImg?t.off(U,this.start):this.$clone&&this.$clone.remove(),t.removeData(T)},move:function(t,i){var e=this.canvas;this.moveTo(n(t)?t:e.left+vt(t),n(i)?i:e.top+vt(i))},moveTo:function(t,i){var e=this.canvas,s=!1;n(i)&&(i=t),t=vt(t),i=vt(i),this.isBuilt&&!this.isDisabled&&this.options.movable&&(C(t)&&(e.left=t,s=!0),C(i)&&(e.top=i,s=!0),s&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=(t=vt(t))<0?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,s,a,o,h,n=this.options,r=this.canvas,p=r.width,l=r.height,c=r.naturalWidth,d=r.naturalHeight;if(0<=(t=vt(t))&&this.isBuilt&&!this.isDisabled&&n.zoomable){if(s=c*t,a=d*t,i&&(e=i.originalEvent),this.trigger(Z,{originalEvent:e,oldRatio:p/c,ratio:s/c}).isDefaultPrevented())return;e?(o=this.$cropper.offset(),h=e.touches?g(e.touches):{pageX:i.pageX||e.pageX||0,pageY:i.pageY||e.pageY||0},r.left-=(s-p)*((h.pageX-o.left-r.left)/p),r.top-=(a-l)*((h.pageY-o.top-r.top)/l)):(r.left-=(s-p)/2,r.top-=(a-l)/2),r.width=s,r.height=a,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+vt(t))},rotateTo:function(t){C(t=vt(t))&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,i){var e=this.image,s=!1;n(i)&&(i=t),t=vt(t),i=vt(i),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(C(t)&&(e.scaleX=t,s=!0),C(i)&&(e.scaleY=i,s=!0),s&&this.renderImage(!0))},scaleX:function(t){var i=this.image.scaleY;this.scale(t,C(i)?i:1)},scaleY:function(t){var i=this.image.scaleX;this.scale(C(i)?i:1,t)},getData:function(e){var s,a,t=this.options,i=this.image,o=this.canvas,h=this.cropBox;return this.isBuilt&&this.isCropped?(a={x:h.left-o.left,y:h.top-o.top,width:h.width,height:h.height},s=i.width/i.naturalWidth,x.each(a,function(t,i){i/=s,a[t]=e?Dt(i):i})):a={x:0,y:0,width:0,height:0},t.rotatable&&(a.rotate=i.rotate||0),t.scalable&&(a.scaleX=i.scaleX||1,a.scaleY=i.scaleY||1),a},setData:function(t){var i,e,s,a=this.options,o=this.image,h=this.canvas,n={};x.isFunction(t)&&(t=t.call(this.element)),this.isBuilt&&!this.isDisabled&&x.isPlainObject(t)&&(a.rotatable&&C(t.rotate)&&t.rotate!==o.rotate&&(o.rotate=t.rotate,this.isRotated=i=!0),a.scalable&&(C(t.scaleX)&&t.scaleX!==o.scaleX&&(o.scaleX=t.scaleX,e=!0),C(t.scaleY)&&t.scaleY!==o.scaleY&&(o.scaleY=t.scaleY,e=!0)),i?this.renderCanvas():e&&this.renderImage(),s=o.width/o.naturalWidth,C(t.x)&&(n.left=t.x*s+h.left),C(t.y)&&(n.top=t.y*s+h.top),C(t.width)&&(n.width=t.width*s),C(t.height)&&(n.height=t.height*s),this.setCropBoxData(n))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var e=this.canvas,s={};return this.isBuilt&&x.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,i){s[i]=e[i]}),s},setCanvasData:function(t){var i=this.canvas,e=i.aspectRatio;x.isFunction(t)&&(t=t.call(this.$element)),this.isBuilt&&!this.isDisabled&&x.isPlainObject(t)&&(C(t.left)&&(i.left=t.left),C(t.top)&&(i.top=t.top),C(t.width)?(i.width=t.width,i.height=t.width/e):C(t.height)&&(i.height=t.height,i.width=t.height*e),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(t){var i,e,s=this.cropBox,a=this.options.aspectRatio;x.isFunction(t)&&(t=t.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&x.isPlainObject(t)&&(C(t.left)&&(s.left=t.left),C(t.top)&&(s.top=t.top),C(t.width)&&(i=!0,s.width=t.width),C(t.height)&&(e=!0,s.height=t.height),a&&(i?s.height=s.width/a:e&&(s.width=s.height*a)),this.renderCropBox())},getCroppedCanvas:function(t){var g,u,i,e,s,a,f,o,h,n,m;if(this.isBuilt&&ft)return this.isCropped?(x.isPlainObject(t)||(t={}),m=this.getData(),g=m.width,u=m.height,o=g/u,x.isPlainObject(t)&&(s=t.width,a=t.height,s&&a?f=s/g:s?(a=s/o,f=s/g):a&&(s=a*o,f=a/u)),i=$t(s||g),e=$t(a||u),(h=x("<canvas>")[0]).width=i,h.height=e,n=h.getContext("2d"),t.fillColor&&(n.fillStyle=t.fillColor,n.fillRect(0,0,i,e)),n.drawImage.apply(n,function(){var t,i,e,s,a,o,h=v(this.$clone[0],this.image),n=h.width,r=h.height,p=this.canvas,l=[h],c=m.x+p.naturalWidth*(Ct(m.scaleX||1)-1)/2,d=m.y+p.naturalHeight*(Ct(m.scaleY||1)-1)/2;return c<=-g||n<c?c=t=e=a=0:c<=0?(e=-c,t=a=wt(n,g+(c=0))):c<=n&&(e=0,t=a=wt(g,n-c)),t<=0||d<=-u||r<d?d=i=s=o=0:d<=0?(s=-d,i=o=wt(r,u+(d=0))):d<=r&&(s=0,i=o=wt(u,r-d)),l.push($t(c),$t(d),$t(t),$t(i)),f&&(e*=f,s*=f,a*=f,o*=f),0<a&&0<o&&l.push($t(e),$t(s),$t(a),$t(o)),l}.call(this)),h):v(this.$clone[0],this.image)},setAspectRatio:function(t){var i=this.options;this.isDisabled||n(t)||(i.aspectRatio=xt(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,s=this.options;this.isLoaded&&!this.isDisabled&&(i=t===ct,e=s.movable&&t===dt,t=i||e?t:ut,this.$dragBox.data(it,t).toggleClass(H,i).toggleClass(W,e),s.cropBoxMovable||this.$face.data(it,t).toggleClass(H,i).toggleClass(W,e))}},f.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},f.setDefaults=function(t){x.extend(f.DEFAULTS,t)},f.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',f.other=x.fn.cropper,x.fn.cropper=function(a){var o,h=s(arguments,1);return this.each(function(){var t,i,e=x(this),s=e.data(T);if(!s){if(/destroy/.test(a))return;t=x.extend({},e.data(),x.isPlainObject(a)&&a),e.data(T,s=new f(this,t))}"string"==typeof a&&x.isFunction(i=s[a])&&(o=i.apply(s,h))}),n(o)?this:o},x.fn.cropper.Constructor=f,x.fn.cropper.setDefaults=f.setDefaults,x.fn.cropper.noConflict=function(){return x.fn.cropper=f.other,this}});